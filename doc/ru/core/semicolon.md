## Автоматическая вставка точек с запятой

Несмотря на то, что JavaScript имеет синтаксис, подобный языкам семейства C, он никоим образом **не принуждает** вас ставить точки с запятой в исходном коде — вы всегда вольны их опустить.

При этом JavaScript — вовсе не язык с полным отсутствием точек с запятой: они на самом деле нужны ему для того, чтобы он мог разобраться в вашем коде. Поэтому парсер JavaScript **автоматически** вставляет их в те места, где сталкивается с ошибкой парсинга по причине их отсутствия.

    var foo = function() {
    } // ошибка разбора, ожидается точка с запятой
    test()

Происходит вставка и парсер пытается снова.

    var foo = function() {
    }; // ошибки нет, парсер продолжает
    test()

Автоматическая вставка точек с запятой считается одним из **наибольших** упущений в проекте языка, поскольку она *действительно может* влиять на поведение кода.

### Как это работает

Приведённый код не содержит точек с запятой, так что места для их вставки остаются на совести парсера:

    (function(window, undefined) {
        function test(options) {
            log('проверяем!')

            (options.list || []).forEach(function(i) {

            })

            options.value.test(
                'здесь передадим длинную строчку',
                'и ещё одну на всякий случай'
            )

            return
            {
                foo: function() {}
            }
        }
        window.test = test

    })(window)

    (function(window) {
        window.someLibrary = {}

    })(window)

Ниже представлен результат игры парсера в «угадалки».

    (function(window, undefined) {
        function test(options) {

            // не вставлена точка с запятой, строки были объединены
            log('тестируем!')(options.list || []).forEach(function(i) {

            }); // <- вставлена

            options.value.test(
                'здесь передадим длинную строчку',
                'и ещё одну на всякий случай'
            ); // <- вставлена

            return; // <- вставлена, в результате
					//    оператор return разбит на два блока
            { // теперь парсер считает этот блок отдельным

                // метка и одинокое выражение
                foo: function() {}
            }; // <- вставлена
        }
        window.test = test; // <- вставлена

    // снова объединились строки
    })(window)(function(window) {
        window.someLibrary = {}; // <- вставлена

    })(window); //<- вставлена

> **Замечание:** Парсер JavaScript некорректно обрабатывает оператор `return`, за которым следует новая строка; Причина может быть и не в автоматической вставке точек с запятой, но без сомнений, это нежелательный побочный эффект.

Парсер радикально поменял поведение изначального кода, а в определённых случаях он вообще сделал **абсолютно неправильные выводы**.

### «Висящие» скобки

Если парсер встречает «висящую» открывающую скобку, то он **не** вставляет точку с запятой.

    log('тестируем!')
    (options.list || []).forEach(function(i) {})

Такой код трасформируется в одну склеенную строку.

    log('тестируем!')(options.list || []).forEach(function(i) {})

**Чрезвычайно** высоки шансы, что `log` **не** возращает *никаких* функций; таким образом, выполнение кода с такой строкой породит `TypeError` с сообщением о том, что `undefined не является функцией`.

### Заключение

Настоятельно рекомендуем **никогда** не забывать ставить точку с запятой; также рекомендуется оставлять скобки на одной строке с соответствующим оператором и никогда не опускать их для выражений с использованием `if` / `else`. Оба этих совета не только повысят читабельность вашего кода, но и предотвратят от изменения поведения кода, произведённого парсером втихую.

