## Автоматическая вставка точек с запятой

Несмотря на то, что синтаксис JavaScript подобен языкам семейства C, он **не принуждает** вас ставить точки с запятой в исходном коде — вам всегда позволено обойтись без них.

При этом JavaScript — не из тех языков, в которых отсутствуют точки с запятой: на самом деле они очень нужны ему — для того, чтобы он мог разобраться в вашем коде. Поэтому парсер JavaScript **автоматически** вставляет их в те места, где сталкивается с ошибкой парсинга, вызванной их отсутствием.

    var foo = function() {
    } // ошибка разбора, ожидается точка с запятой
    test()

Происходит вставка и парсер пытается снова.

    var foo = function() {
    }; // ошибки нет, парсер продолжает
    test()

Автоматическая вставка точек с запятой считается одним из **наибольших** упущений в проекте языка, поскольку такая вставка *действительно может* влиять на поведение кода.

### Как это работает

Приведённый код не содержит точек с запятой, так что места для их вставки остаются на совести парсера:

    (function(window, undefined) {
        function test(options) {
            log('проверяем!')

            (options.list || []).forEach(function(i) {

            })

            options.value.test(
                'здесь передадим длинную строчку',
                'и ещё одну на всякий случай'
            )

            return
            {
                foo: function() {}
            }
        }
        window.test = test

    })(window)

    (function(window) {
        window.someLibrary = {}

    })(window)

Ниже представлен результат игры парсера в «угадалки».

    (function(window, undefined) {
        function test(options) {

            // не вставлена точка с запятой, строки были объединены
            log('тестируем!')(options.list || []).forEach(function(i) {

            }); // <- вставлена

            options.value.test(
                'здесь передадим длинную строчку',
                'и ещё одну на всякий случай'
            ); // <- вставлена

            return; // <- вставлена, в результате
					//    оператор return разбит на два блока
            { // теперь парсер считает этот блок отдельным

                // метка и одинокое выражение
                foo: function() {}
            }; // <- вставлена
        }
        window.test = test; // <- вставлена

    // снова объединились строки
    })(window)(function(window) {
        window.someLibrary = {}; // <- вставлена

    })(window); //<- вставлена

> **Замечание:** Парсер JavaScript некорректно обрабатывает оператор `return`, за которым следует новая строка; Причина может скрываться и не за автоматической вставкой точек с запятой — но без сомнений — этот побочный эффект нежелателен.

Парсер радикально поменял поведение изначального кода, а в определённых случаях он вообще сделал **абсолютно неправильные выводы**.

### «Висящие» скобки

Если парсер встречает «висящую» открывающую скобку, он **не** вставляет точку с запятой.

    log('тестируем!')
    (options.list || []).forEach(function(i) {})

Такой код трансформируется в одну склеенную строку.

    log('тестируем!')(options.list || []).forEach(function(i) {})

Шансы на то, что `log` **не** вернёт функцию, **крайне** высоки; так что выполнение этой строки кода породит `TypeError`, приправив его сообщением о том, что `undefined не является функцией`.

### Заключение

Настоятельно рекомендуем **никогда** не забывать ставить точку с запятой; также рекомендуется оставлять скобки на одной строке с соответствующим оператором и всегда использовать их в выражениях `if` / `else`. Оба этих совета не только повысят читабельность вашего кода, но и предотвратят вас от изменений в поведении кода, сделанных парсером без вашего ведома.

